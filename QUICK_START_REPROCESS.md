# ì‹¤íŒ¨í•œ ì²­í¬ ì¬ì²˜ë¦¬ - ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

íŒ¨ëŸ¬ëŸ´ ë°°ì¹˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ connection timeout ë“±ìœ¼ë¡œ ì‹¤íŒ¨í•œ ì²­í¬ë“¤ì„ ì¬ì²˜ë¦¬í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. Dry-runìœ¼ë¡œ ë¯¸ë¦¬ í™•ì¸ (ê¶Œì¥)

```bash
# ì „ì²´ ì²­í¬ í™•ì¸
./reprocess_failed_chunks.sh --dry-run

# ë˜ëŠ” Pythonìœ¼ë¡œ
python3 reprocess_failed_chunks.py --dry-run
```

### 2. íŠ¹ì • ì„ ë°•ë§Œ í…ŒìŠ¤íŠ¸

```bash
# Dry-runìœ¼ë¡œ íŠ¹ì • ì„ ë°• í™•ì¸
./reprocess_failed_chunks.sh --dry-run --ship IMO9986063

# ì‹¤ì œ ì²˜ë¦¬
./reprocess_failed_chunks.sh --ship IMO9986063
```

### 3. ì „ì²´ ì¬ì²˜ë¦¬ ì‹¤í–‰

```bash
# ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰ (ê¶Œì¥)
./reprocess_failed_chunks.sh

# ë˜ëŠ” Pythonìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰
python3 reprocess_failed_chunks.py
```

## ğŸ“Š ì‚¬ìš© ì˜ˆì œ

### ì˜ˆì œ 1: ê¸°ë³¸ ì‹¤í–‰
```bash
./reprocess_failed_chunks.sh
```

### ì˜ˆì œ 2: íŠ¹ì • ì„ ë°•ë§Œ ì²˜ë¦¬
```bash
./reprocess_failed_chunks.sh --ship IMO9986063
```

### ì˜ˆì œ 3: ì§€ì—° ì‹œê°„ ì¡°ì • (DB ë¶€í•˜ê°€ ë†’ì„ ë•Œ)
```bash
./reprocess_failed_chunks.sh -d 1.0
```

### ì˜ˆì œ 4: ë‹¤ë¥¸ CSV íŒŒì¼ ì‚¬ìš©
```bash
./reprocess_failed_chunks.sh my_failed_chunks.csv
```

### ì˜ˆì œ 5: ì¡°í•© ì‚¬ìš©
```bash
./reprocess_failed_chunks.sh --ship IMO9986063 -d 1.0 --dry-run
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
post_proc.csv                          # ì…ë ¥: ì‹¤íŒ¨í•œ ì²­í¬ ëª©ë¡
reprocess_failed_chunks.py             # ì¬ì²˜ë¦¬ Python ìŠ¤í¬ë¦½íŠ¸
reprocess_failed_chunks.sh             # ì‹¤í–‰ìš© ì‰˜ ìŠ¤í¬ë¦½íŠ¸
failed_chunks_after_reprocess.csv      # ì¶œë ¥: ì—¬ì „íˆ ì‹¤íŒ¨í•œ ì²­í¬ (ìƒì„± ì‹œ)
logs/reprocess_YYYYMMDD_HHMMSS.log     # ì¬ì²˜ë¦¬ ì „ìš© ë¡œê·¸ íŒŒì¼
logs/reprocess_latest.log              # ìµœì‹  ë¡œê·¸ (ì‹¬ë³¼ë¦­ ë§í¬)
```

**ì¤‘ìš”**: ì¬ì²˜ë¦¬ ë¡œê·¸ëŠ” ê¸°ì¡´ `logs/migration.log`ì™€ **ë¶„ë¦¬**ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.

## ğŸ“ CSV íŒŒì¼ í˜•ì‹

```csv
IMO9986063,2025-06-15 14:40:40.388958,2025-06-15 20:40:40.388958
IMO9986104,2025-07-16 02:40:40.394745,2025-07-16 08:40:40.394745
```

- ì²« ë²ˆì§¸ ì»¬ëŸ¼: ì„ ë°• ID
- ë‘ ë²ˆì§¸ ì»¬ëŸ¼: ì²­í¬ ì‹œì‘ ì‹œê°„ (ISO 8601 í˜•ì‹)
- ì„¸ ë²ˆì§¸ ì»¬ëŸ¼: ì²­í¬ ì¢…ë£Œ ì‹œê°„ (ISO 8601 í˜•ì‹)

## ğŸ¯ ì¶”ì²œ ì›Œí¬í”Œë¡œìš°

### ë‹¨ê³„ 1: í™•ì¸
```bash
# Dry-runìœ¼ë¡œ ë¬´ì—‡ì´ ì²˜ë¦¬ë ì§€ í™•ì¸
./reprocess_failed_chunks.sh --dry-run
```

### ë‹¨ê³„ 2: í…ŒìŠ¤íŠ¸
```bash
# í•œ ì„ ë°•ë§Œ ë¨¼ì € í…ŒìŠ¤íŠ¸
./reprocess_failed_chunks.sh --ship IMO9986063
```

### ë‹¨ê³„ 3: ì „ì²´ ì‹¤í–‰
```bash
# ëª¨ë“  ì‹¤íŒ¨í•œ ì²­í¬ ì¬ì²˜ë¦¬
./reprocess_failed_chunks.sh
```

### ë‹¨ê³„ 4: ì¬ì‹œë„ (í•„ìš”ì‹œ)
```bash
# ì—¬ì „íˆ ì‹¤íŒ¨í•œ ì²­í¬ê°€ ìˆë‹¤ë©´
./reprocess_failed_chunks.sh failed_chunks_after_reprocess.csv
```

## âš™ï¸ ì£¼ìš” ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… | ì˜ˆì œ |
|------|------|------|
| `--dry-run` | ì‹¤ì œ ì²˜ë¦¬ ì—†ì´ í™•ì¸ë§Œ | `--dry-run` |
| `--ship SHIP_ID` | íŠ¹ì • ì„ ë°•ë§Œ ì²˜ë¦¬ | `--ship IMO9986063` |
| `-d, --delay N` | ì²­í¬ ì‚¬ì´ ì§€ì—° ì‹œê°„ (ì´ˆ) | `-d 1.0` |
| `-h, --help` | ë„ì›€ë§ í‘œì‹œ | `-h` |

## ğŸ“Š ì¶œë ¥ ì˜ˆì‹œ

```
================================================================================
ğŸš€ Starting failed chunk reprocessing
================================================================================
ğŸ“‚ Loading failed chunks from post_proc.csv
âœ… Loaded 90 failed chunks
ğŸ“Š Total chunks to reprocess: 90

================================================================================
ğŸ“¦ Processing chunk 1/90
   Ship: IMO9986063
   Range: 2025-06-15 14:40:40.388958 to 2025-06-15 20:40:40.388958
================================================================================
âœ… Chunk 1/90 completed: 12,345 records
ğŸ“Š Progress: 1.1% (1/90)
ğŸ“Š Stats: âœ… 1 | âŒ 0 | â­ï¸ 0

...

================================================================================
ğŸ Reprocessing completed
================================================================================
ğŸ“Š Total chunks: 90
âœ… Successful: 87
âŒ Failed: 2
â­ï¸ Skipped: 1
ğŸ“ˆ Total records processed: 1,234,567
â±ï¸ Total time: 450.23 seconds
ğŸ“Š Success rate: 96.7%
âš¡ Average time per chunk: 5.00 seconds
```

## â“ ë¬¸ì œ í•´ê²°

### CSV íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
```
âŒ Error: CSV file not found: post_proc.csv
```
**í•´ê²°**: íŒŒì¼ì´ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
```
âŒ Failed to reprocess chunk: connection already closed
```
**í•´ê²°**: 
- ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
- `config.py`ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • í™•ì¸
- ì§€ì—° ì‹œê°„ ì¦ê°€: `./reprocess_failed_chunks.sh -d 2.0`

### ì‹¤íŒ¨í•œ ì²­í¬ê°€ ê³„ì† ë°œìƒ
**í•´ê²°**:
1. ë¡œê·¸ í™•ì¸: `tail -f logs/migration.log`
2. ì§€ì—° ì‹œê°„ ì¦ê°€
3. DB ë¶€í•˜ í™•ì¸
4. chunk_size_hours ê°ì†Œ ê³ ë ¤

## ğŸ’¡ íŒ

1. **í•­ìƒ dry-runë¶€í„°**: ì‹¤ì œ ì²˜ë¦¬ ì „ì— dry-runìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”
2. **í•œ ì„ ë°•ì”© í…ŒìŠ¤íŠ¸**: ì „ì²´ ì‹¤í–‰ ì „ì— í•œ ì„ ë°•ë§Œ ë¨¼ì € í…ŒìŠ¤íŠ¸
3. **DB ë¶€í•˜ ì¡°ì ˆ**: ì§€ì—° ì‹œê°„ì„ ì ì ˆíˆ ì¡°ì •í•˜ì„¸ìš”
4. **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: ë³„ë„ í„°ë¯¸ë„ì—ì„œ ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸
   ```bash
   tail -f logs/reprocess_latest.log
   ```
5. **ì¬ì‹œë„ ì „ëµ**: ì‹¤íŒ¨í•œ ì²­í¬ëŠ” CSVë¡œ ì €ì¥ë˜ë¯€ë¡œ ì‰½ê²Œ ì¬ì‹œë„ ê°€ëŠ¥

## ğŸ“ ë¡œê·¸ í™•ì¸

ì¬ì²˜ë¦¬ ë¡œê·¸ëŠ” **ë³„ë„ì˜ íŒŒì¼**ì— ì €ì¥ë©ë‹ˆë‹¤:

```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
tail -f logs/reprocess_latest.log

# íŠ¹ì • ì„ ë°• í•„í„°ë§
tail -f logs/reprocess_latest.log | grep IMO9986063

# ëª¨ë“  ì¬ì²˜ë¦¬ ë¡œê·¸ ëª©ë¡
ls -lt logs/reprocess_*.log
```

## ğŸ“š ìƒì„¸ ë¬¸ì„œ

ë” ìì„¸í•œ ì •ë³´ëŠ” [REPROCESS_GUIDE.md](./REPROCESS_GUIDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

## ğŸ†˜ ì§€ì›

ë¬¸ì œê°€ ìˆê±°ë‚˜ ì§ˆë¬¸ì´ ìˆìœ¼ë©´ í”„ë¡œì íŠ¸ ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.

